<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Responder Cota√ß√£o</title>
<style>
  body{font-family:"Inter",Arial,sans-serif;background:#f9fafb;margin:0;padding:20px;}
  .box{max-width:800px;margin:auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);}
  h1{text-align:center;}
  select,input,button{padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:6px;width:100%;}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  th,td{border:1px solid #ddd;padding:8px;}
  th{background:#2563eb;color:#fff;}
  button{background:#2563eb;color:#fff;cursor:pointer;}
  button:hover{background:#1d4ed8;}
</style>
</head>
<body>
<h1>Responder Cota√ß√£o</h1>
<div class="box">
  <label>Fornecedor:</label>
  <select id="fornecedor"><option value="">Selecione...</option><option>Fornecedor A</option><option>Fornecedor B</option><option>Fornecedor C</option></select>
  <table><thead><tr><th>Produto</th><th>Qtd</th><th>Unidade</th><th>Pre√ßo Unit√°rio</th><th>Obs</th></tr></thead><tbody id="tbody"></tbody></table>
  <button onclick="enviar()">üì§ Enviar Respostas</button>
</div>
<script>
const URL_COTACAO='SUA_URL_COTACAO';
let itens=[];

window.onload=()=>{
  const p=new URLSearchParams(window.location.search);
  const rid=p.get("rid"),code=p.get("code"),prod=p.get("prod"),qtd=p.get("qtd"),unid=p.get("unid");
  if(rid&&code){itens=[{rid,codigo:code,produto:prod||"Produto",quantidade:qtd||1,unidade:unid||"UN"}];render();}
  else{document.getElementById("tbody").innerHTML="<tr><td colspan=5>Sem item</td></tr>";}
};

function render(){
  const tb=document.getElementById("tbody");tb.innerHTML="";
  itens.forEach(it=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${it.produto}</td><td>${it.quantidade}</td><td>${it.unidade}</td><td><input type=number step=0.01 data-rid="${it.rid}" data-codigo="${it.codigo}"></td><td><input type=text></td>`;
    tb.appendChild(tr);
  });
}

async function enviar(){
  const forn=document.getElementById("fornecedor").value;if(!forn){alert("Selecione fornecedor");return;}
  const linhas=document.querySelectorAll("#tbody tr");
  for(const ln of linhas){
    const preco=ln.querySelector("input[type=number]").value;
    const obs=ln.querySelector("input[type=text]").value;
    const rid=ln.querySelector("input[type=number]").dataset.rid;
    const codigo=ln.querySelector("input[type=number]").dataset.codigo;
    if(!preco)continue;
    const payload={action:"enviar_resposta",rid,produtoCodigo:codigo,fornecedor:forn,preco,observacoes:obs};
    await fetch(URL_COTACAO,{method:"POST",headers:{'Content-Type':'text/plain;charset=utf-8'},body:JSON.stringify(payload)});
  }
  alert("Respostas enviadas!");
}
</script>
</body>
</html>
