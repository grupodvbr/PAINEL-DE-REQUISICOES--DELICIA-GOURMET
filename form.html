<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><?= titulo ?></title>
    <style>
      body{ font-family: system-ui, Arial, sans-serif; padding:24px; background:#f7f7f8; }
      .card{ background:#fff; max-width:560px; margin:0 auto; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.08); }
      h1{ font-size:18px; margin:0 0 12px; }
      label{ display:block; margin:10px 0 4px; font-weight:600; }
      input, textarea{ width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; font-size:14px; }
      button{ margin-top:14px; background:#007bff; color:#fff; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; }
      .ok{ padding:12px; background:#e8f5e9; border:1px solid #a7d7a9; color:#256029; border-radius:8px; margin-top:12px; }
      .err{ padding:12px; background:#fdecea; border:1px solid #f5c2c0; color:#7a1c1a; border-radius:8px; margin-top:12px; }
      .help{ color:#444; font-size:13px; margin-top:4px; }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Responder Cotação — <?= produto ? produto : code ?></h1>
      <form id="f">
        <input type="hidden" name="action" value="enviar_resposta">
        <input type="hidden" name="rid" value="<?= rid ?>">
        <input type="hidden" name="produtoCodigo" value="<?= code ?>">
        <input type="hidden" name="produtoNome" value="<?= produto ?>">

        <label>Fornecedor</label>
        <input name="fornecedor" required placeholder="Nome da empresa">

        <label>Preço unitário (R$)</label>
        <input name="preco" required type="number" step="0.01" min="0">

        <label>Validade da proposta (dias)</label>
        <input name="validadeDias" type="number" step="1" min="0">

        <label>Prazo de entrega (dias)</label>
        <input name="prazoEntrega" type="number" step="1" min="0">

        <label>Observações</label>
        <textarea name="observacoes" rows="3" placeholder="Condições, frete, impostos…"></textarea>

        <button type="submit">Enviar</button>
        <div id="msg"></div>
      </form>
    </div>

    <script>
      const form = document.getElementById('f');
      form.addEventListener('submit', async (ev)=>{
        ev.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        try{
          const res = await fetch('<?= postUrl ?>', {
            method:'POST',
            headers:{ 'Content-Type':'application/json' },
            body: JSON.stringify(data)
          });
          const out = await res.json();
          if (!out.ok) throw new Error(out.error || 'Falha ao enviar');
          document.getElementById('msg').innerHTML = '<div class="ok">Obrigado! Sua proposta foi registrada.</div>';
          form.reset();
        }catch(e){
          document.getElementById('msg').innerHTML = '<div class="err">Erro: ' + e.message + '</div>';
        }
      });
    </script>
  </body>
</html>
