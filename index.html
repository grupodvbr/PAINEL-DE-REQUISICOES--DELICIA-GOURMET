<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel de Requisi√ß√µes</title>
  <style>
    :root {
      --cor-fundo:#f9fafb; --cor-texto:#111827; --cor-botao:#2563eb;
      --cor-botao-vermelho:#dc2626; --cor-cinza-claro:#f3f4f6; --cor-card:#fff;
    }
    *{box-sizing:border-box;}
    body{margin:0;font-family:"Inter",Arial,sans-serif;background:var(--cor-fundo);color:var(--cor-texto);}
    h1{margin:0;padding:15px 0;font-size:1.6em;font-weight:700;text-align:center;}
    .header-flex{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:var(--cor-card);border-bottom:1px solid #e5e7eb;}
    .logo-area img{height:48px;}
    .botoes-acoes button{background:var(--cor-botao);color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer;}
    .botoes-acoes button:hover{background:#1d4ed8;}
    .meta{font-size:.8em;color:#6b7280;margin-left:8px}
    .filtros{display:flex;flex-wrap:wrap;gap:10px;padding:15px 20px;background:var(--cor-cinza-claro);border-radius:8px;margin:15px;}
    .filtros label{display:flex;flex-direction:column;font-size:.85em;font-weight:600;}
    .filtros input,.filtros select{padding:8px;font-size:1em;border:1px solid #d1d5db;border-radius:6px;margin-top:4px;}
    #btnFiltrar{background:var(--cor-botao);color:#fff;border:none;border-radius:6px;padding:10px 16px;cursor:pointer;}
    #btnFiltrar:hover{background:#1d4ed8;}
    .tabela-container{max-width:98%;margin:20px auto;background:var(--cor-card);border-radius:8px;overflow-x:auto;box-shadow:0 2px 4px rgba(0,0,0,.05);}
    table{width:100%;border-collapse:collapse;font-size:.95em;}
    thead th{background:var(--cor-botao);color:#fff;padding:8px;position:sticky;top:0;}
    tbody td{padding:8px;border-bottom:1px solid #e5e7eb;}
    .acoes button{margin:2px;padding:6px 10px;font-size:.85em;border:none;border-radius:6px;cursor:pointer;}
    .acoes .btn-carrinho{background:#6b7280;color:#fff;}
    .acoes .btn-carrinho.in{background:#16a34a;}
    .acoes .btn-neg{background:#dc2626;color:#fff;}
    .acoes .btn-hist{background:#0ea5e9;color:#fff;}
    #modalCarrinho,#modalHistorico{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.4);justify-content:center;align-items:center;z-index:1000;}
    .box{background:#fff;padding:20px;border-radius:10px;width:90vw;max-width:1000px;max-height:90vh;overflow:auto;}
    .box table{width:100%;border-collapse:collapse;margin-top:10px;}
    .box th,.box td{border:1px solid #d1d5db;padding:8px;text-align:left;}
    .box th{background:#f3f4f6;}
  </style>
</head>
<body>
  <div class="header-flex">
    <div class="logo-area"><img src="https://static.wixstatic.com/media/d830b0_8cec50a98bbf4775814dbfa5386585e8~mv2.png" alt="logo"></div>
    <h1 id="tituloPainel">Painel de Requisi√ß√µes ‚Ä¢ <span id="empresaSpan">DEL√çCIA GOURMET</span> <span class="meta" id="codigoSpan">(DG-REQ-001)</span></h1>
    <div class="botoes-acoes"><button onclick="abrirCarrinho()">üõí Carrinho</button></div>
  </div>

  <div class="tabela-container">
    <table><thead><tr>
      <th>Data</th><th>Item</th><th>Qtd</th><th>Unidade</th><th>Setor</th><th>Solicitante</th><th>Observa√ß√µes</th><th>Status</th><th>A√ß√µes</th>
    </tr></thead><tbody id="tabelaRequisicoes"></tbody></table>
  </div>

  <!-- Modal Carrinho -->
  <div id="modalCarrinho"><div class="box">
    <h3>üõí Itens no Carrinho</h3>
    <table><thead><tr>
      <th>Item</th><th>C√≥digo</th><th>Qtd</th><th>Unidade</th><th>Setor</th><th>Solicitante</th><th>Cota√ß√£o</th><th>A√ß√£o</th>
    </tr></thead><tbody id="tabelaCarrinhoModal"></tbody></table>

    <div id="linksFornecedores" style="margin-top:20px;padding:10px;background:#f3f4f6;border-radius:6px;">
      <h4>üì® Links para fornecedores</h4>
      <ul id="listaLinks"></ul>
    </div>

    <br><button onclick="fecharCarrinho()">Fechar</button>
  </div></div>

<script>
let EMPRESA = "DEL√çCIA GOURMET";
let CODIGO_PAINEL = "DG-REQ-001";

const URL_DADOS = 'https://script.google.com/macros/s/AKfycbzjVWXyGuwLDEfqNwgJppU2Yvo3_r_L7wbD1-AXfd3lztOUlq5zbKTQ0QCP7IknVae4TA/exec';
const URL_STATUS = 'https://script.google.com/macros/s/AKfycbxnuFAAJLiThcP99gpgk-EhHIJ2N2YOXjpi7jVROHq6ZqniAkcXlI2h8uj16oTQHsVWnQ/exec';
const URL_COTACAO = 'https://script.google.com/macros/s/AKfycbwYbKucp5qnKpiiBVQJnOhtFXmudmEGzqjgoSfhcRHVKc3hiqGQCuRUYrVicbkxRC0/exec'; // <<<< TROCAR PELO SEU URL
      
const FORNECEDORES = ["FornecedorA","FornecedorB"];

let carrinho = JSON.parse(localStorage.getItem("carrinhoCompras")||'[]');
let requisicoes = [];

// ... carregarDados() e renderizarTabela() iguais ...

// üîπ Ao clicar em ‚ûï, j√° salva na planilha de COTA√á√ïES
async function addCarrinho(linha,btn){
  const payload = {
    action: 'registrar_cotacao',
    empresa: EMPRESA,
    painelCodigo: CODIGO_PAINEL,
    produtoCodigo: linha[1],      // c√≥digo/descri√ß√£o
    produtoNome: linha[1],        // nome do produto
    quantidade: linha[3],
    unidade: linha[2],
    setor: linha[4],
    solicitante: linha[5],
    observacoes: linha[6] || '',
    chaveOrigem: linha[0]         // timestamp da requisi√ß√£o
  };

  try {
    const res = await fetch(URL_COTACAO,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const out = await res.json();

    if(!out.ok){
      alert("Erro ao registrar cota√ß√£o: "+out.error);
      return;
    }

    // üîπ s√≥ adiciona ao carrinho local se foi salvo no GAS
    carrinho.push({
      ...payload,
      rid: out.rid,
      cotacaoLink: out.linkCotacao
    });
    localStorage.setItem("carrinhoCompras", JSON.stringify(carrinho));

    btn.textContent='üõí';
    btn.className='btn-carrinho in';
    alert("‚úÖ Cota√ß√£o registrada na planilha!");

  } catch(e){
    alert("Erro de rede: "+e.message);
  }
}
</script>

</body>
</html>
